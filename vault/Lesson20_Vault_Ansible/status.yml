- name: Enable mysql secrets engine
  hosts: consulclient1
  tasks:

    - name: Check if Vault is unsealed
      environment:
        VAULT_ADDR: https://vault.askarta.local:8200
      command: vault status
      register: vault_status_result
      ignore_errors: True

    - name: fail the play if the previous command did not succeed
      fail:
        msg: "Vault is sealed"
      when: "'FAILED' in vault_status_result.stderr"
